<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>PHAGES — backend test</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 2rem; }
      button { padding: .5rem 1rem; margin-right: .5rem; }
      pre { background:#111; color:#0f0; padding:1rem; min-height:12rem; overflow:auto; }
      label { display:block; margin:.75rem 0 .25rem; }
      input { width:100%; padding:.5rem; }
    </style>
  </head>
  <body>
    <h1>PHAGES — backend test</h1>

    <button id="btnHealth">Ping /health</button>
    <button id="btnAnalyze">Call /analyze</button>

    <label>Prompt</label>
    <input id="prompt" value="please analyze cat belly fluff" />

    <label>Manifest URL</label>
    <input id="manifest" value="https://raw.githubusercontent.com/42-Degrees/phages-index-assets/main/manifest-mini-v1.json" />

    <h3>Output</h3>
    <pre id="out">(waiting)</pre>

    <script>
      const backend = "https://phages-backend.onrender.com";
      const OUT = document.getElementById("out");
      const show = (x) => OUT.textContent = typeof x === "string" ? x : JSON.stringify(x, null, 2);

      async function ping() {
        show("Calling /health …");
        try {
          const r = await fetch(`${backend}/health`);
          show(await r.json());
        } catch (e) {
          show("Health failed: " + e);
          console.error(e);
        }
      }

      async function analyze() {
        show("Calling /analyze …");
        const body = new URLSearchParams({
          user_prompt: document.getElementById("prompt").value,
          faiss_path:  document.getElementById("manifest").value
        });

        try {
          const r = await fetch(`${backend}/analyze`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body
          });

          const raw = await r.text();
          console.log("Status", r.status, "Body", raw);
          try { show(JSON.parse(raw)); } catch { show(raw); }
        } catch (e) {
          show("Analyze failed: " + e);
          console.error(e);
        }
      }

      document.getElementById("btnHealth").onclick  = ping;
      document.getElementById("btnAnalyze").onclick = analyze;
    </script>
  </body>
</html>
